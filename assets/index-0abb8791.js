import*as n from"https://cdn.jsdelivr.net/npm/three@0.118/build/three.module.js";import{FBXLoader as u}from"https://cdn.jsdelivr.net/npm/three@0.118.1/examples/jsm/loaders/FBXLoader.js";import{OrbitControls as p}from"https://cdn.jsdelivr.net/npm/three@0.118/examples/jsm/controls/OrbitControls.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}})();var m=document.getElementById("btn2"),w=document.getElementById("btn3"),y=document.getElementById("btn4"),k=document.getElementById("btn"),g=document.getElementById("btn5");class b{constructor(e){this._animations=e}get animations(){return this._animations}}class S{constructor(e){this._Init(e)}_Init(e){this._params=e,this._deceleration=new n.Vector3(-5e-4,-1e-4,-5),this._acceleration=new n.Vector3(1,.25,50),this._velocity=new n.Vector3(0,0,0),this._animations={},this._input=new E,this._stateMachine=new v(new b(this._animations)),this._LoadModels()}_LoadModels(){const e=new u;e.setPath("./resources/warrior/"),e.load("humano.fbx",t=>{t.scale.setScalar(.1),t.traverse(s=>{s.castShadow=!0}),this._target=t,this._params.scene.add(this._target),this._mixer=new n.AnimationMixer(this._target),this._manager=new n.LoadingManager,this._manager.onLoad=()=>{this._stateMachine.SetState("idle")};const i=(s,r)=>{const o=r.animations[0],h=this._mixer.clipAction(o);this._animations[s]={clip:o,action:h}},a=new u(this._manager);a.setPath("./resources/warrior/"),a.load("caminar.fbx",s=>{i("walk",s)}),a.load("correr.fbx",s=>{i("run",s)}),a.load("quieto.fbx",s=>{i("idle",s)})})}Update(e){if(!this._target)return;this._stateMachine.Update(e,this._input);const t=this._velocity,i=new n.Vector3(t.x*this._deceleration.x,t.y*this._deceleration.y,t.z*this._deceleration.z);i.multiplyScalar(e),i.z=Math.sign(i.z)*Math.min(Math.abs(i.z),Math.abs(t.z)),t.add(i);const a=this._target,s=new n.Quaternion,r=new n.Vector3,o=a.quaternion.clone(),h=this._acceleration.clone();this._input._keys.shift&&h.multiplyScalar(3),this._input._keys.forward&&(t.z+=h.z*e),this._input._keys.backward&&(t.z-=h.z*e),this._input._keys.left&&(r.set(0,1,0),s.setFromAxisAngle(r,4*Math.PI*e*this._acceleration.y),o.multiply(s)),this._input._keys.right&&(r.set(0,1,0),s.setFromAxisAngle(r,4*-Math.PI*e*this._acceleration.y),o.multiply(s)),a.quaternion.copy(o);const l=new n.Vector3;l.copy(a.position);const d=new n.Vector3(0,0,1);d.applyQuaternion(a.quaternion),d.normalize();const _=new n.Vector3(1,0,0);_.applyQuaternion(a.quaternion),_.normalize(),_.multiplyScalar(t.x*e),d.multiplyScalar(t.z*e),a.position.add(d),a.position.add(_),l.copy(a.position),this._mixer&&this._mixer.update(e)}}class E{constructor(){this._Init()}_Init(){this._keys={forward:!1,backward:!1,left:!1,right:!1,space:!1,shift:!1},document.addEventListener("keydown",r=>this._onKeyDown(r),!1),document.addEventListener("keyup",r=>this._onKeyUp(r),!1),k.addEventListener("click",r=>e(),!1),m.addEventListener("click",r=>t(),!1),w.addEventListener("click",r=>i(),!1),y.addEventListener("click",r=>a(),!1),g.addEventListener("click",r=>s(),!1);const e=r=>{this._keys.backward=!1,this._keys.right=!1,this._keys.forward=!0,this._keys.left=!1},t=r=>{this._keys.right=!1,this._keys.forward=!1,this._keys.backward=!0,this._keys.left=!1},i=r=>{this._keys.right=!0,this._keys.forward=!0,this._keys.backward=!1,this._keys.left=!1},a=r=>{this._keys.forward=!1,this._keys.backward=!1,this._keys.right=!1,this._keys.left=!1},s=r=>{this._keys.left=!0,this._keys.forward=!0,this._keys.backward=!1,this._keys.right=!1}}_onKeyDown(e){switch(e.keyCode){case 87:this._keys.forward=!0;break;case 65:this._keys.left=!0;break;case 83:this._keys.backward=!0;break;case 68:this._keys.right=!0;break;case 32:this._keys.space=!0;break;case 16:this._keys.shift=!0;break}}_onKeyUp(e){switch(e.keyCode){case 87:this._keys.forward=!1;break;case 65:this._keys.left=!1;break;case 83:this._keys.backward=!1;break;case 68:this._keys.right=!1;break;case 32:this._keys.space=!1;break;case 16:this._keys.shift=!1;break}}}class x{constructor(){this._states={},this._currentState=null}_AddState(e,t){this._states[e]=t}SetState(e){const t=this._currentState;if(t){if(t.Name==e)return;t.Exit()}const i=new this._states[e](this);this._currentState=i,i.Enter(t)}Update(e,t){this._currentState&&this._currentState.Update(e,t)}}class v extends x{constructor(e){super(),this._proxy=e,this._Init()}_Init(){this._AddState("idle",M),this._AddState("walk",A),this._AddState("run",F)}}class f{constructor(e){this._parent=e}Enter(){}Exit(){}Update(){}}class A extends f{constructor(e){super(e)}get Name(){return"walk"}Enter(e){const t=this._parent._proxy._animations.walk.action;if(e){const i=this._parent._proxy._animations[e.Name].action;if(t.enabled=!0,e.Name=="run"){const a=t.getClip().duration/i.getClip().duration;t.time=i.time*a}else t.time=0,t.setEffectiveTimeScale(1),t.setEffectiveWeight(1);t.crossFadeFrom(i,.5,!0),t.play()}else t.play()}Exit(){}Update(e,t){if(t._keys.forward||t._keys.backward){t._keys.shift&&this._parent.SetState("run");return}this._parent.SetState("idle")}}class F extends f{constructor(e){super(e)}get Name(){return"run"}Enter(e){const t=this._parent._proxy._animations.run.action;if(e){const i=this._parent._proxy._animations[e.Name].action;if(t.enabled=!0,e.Name=="walk"){const a=t.getClip().duration/i.getClip().duration;t.time=i.time*a}else t.time=0,t.setEffectiveTimeScale(1),t.setEffectiveWeight(1);t.crossFadeFrom(i,.5,!0),t.play()}else t.play()}Exit(){}Update(e,t){if(t._keys.forward||t._keys.backward){t._keys.shift||this._parent.SetState("walk");return}this._parent.SetState("idle")}}class M extends f{constructor(e){super(e)}get Name(){return"idle"}Enter(e){const t=this._parent._proxy._animations.idle.action;if(e){const i=this._parent._proxy._animations[e.Name].action;t.time=0,t.enabled=!0,t.setEffectiveTimeScale(1),t.setEffectiveWeight(1),t.crossFadeFrom(i,.5,!0),t.play()}else t.play()}Exit(){}Update(e,t){(t._keys.forward||t._keys.backward)&&this._parent.SetState("walk")}}class L{constructor(){this._Initialize()}_Initialize(){this._threejs=new n.WebGLRenderer({antialias:!0}),this._threejs.outputEncoding=n.sRGBEncoding,this._threejs.shadowMap.enabled=!0,this._threejs.shadowMap.type=n.PCFSoftShadowMap,this._threejs.setPixelRatio(window.devicePixelRatio),this._threejs.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this._threejs.domElement),window.addEventListener("resize",()=>{this._OnWindowResize()},!1);const e=60,t=1920/1080,i=1,a=1e3;this._camera=new n.PerspectiveCamera(e,t,i,a),this._camera.position.set(25,10,25),this._scene=new n.Scene;let s=new n.DirectionalLight(16777215,1);s.position.set(-100,100,100),s.target.position.set(0,0,0),s.castShadow=!0,s.shadow.bias=-.001,s.shadow.mapSize.width=4096,s.shadow.mapSize.height=4096,s.shadow.camera.near=.1,s.shadow.camera.far=500,s.shadow.camera.near=.5,s.shadow.camera.far=500,s.shadow.camera.left=50,s.shadow.camera.right=-50,s.shadow.camera.top=50,s.shadow.camera.bottom=-50,this._scene.add(s),s=new n.AmbientLight(16777215,.25),this._scene.add(s);const r=new p(this._camera,this._threejs.domElement);r.target.set(0,10,0),r.update();const o=new n.Mesh(new n.PlaneGeometry(100,100,5,5),new n.MeshStandardMaterial({color:8421504}));o.castShadow=!1,o.receiveShadow=!0,o.rotation.x=-Math.PI/2,this._scene.add(o),this._mixers=[],this._previousRAF=null,this._LoadAnimatedModel(),this._RAF()}_LoadAnimatedModel(){const e={camera:this._camera,scene:this._scene};this._controls=new S(e)}_LoadAnimatedModelAndPlay(e,t,i,a){const s=new u;s.setPath(e),s.load(t,r=>{r.scale.setScalar(.1),r.traverse(h=>{h.castShadow=!0}),r.position.copy(a);const o=new u;o.setPath(e),o.load(i,h=>{const l=new n.AnimationMixer(r);this._mixers.push(l),l.clipAction(h.animations[0]).play()}),this._scene.add(r)})}_OnWindowResize(){this._camera.aspect=window.innerWidth/window.innerHeight,this._camera.updateProjectionMatrix(),this._threejs.setSize(window.innerWidth,window.innerHeight)}_RAF(){requestAnimationFrame(e=>{this._previousRAF===null&&(this._previousRAF=e),this._RAF(),this._threejs.render(this._scene,this._camera),this._Step(e-this._previousRAF),this._previousRAF=e})}_Step(e){const t=e*.001;this._mixers&&this._mixers.map(i=>i.update(t)),this._controls&&this._controls.Update(t)}}window.addEventListener("DOMContentLoaded",()=>{new L});
